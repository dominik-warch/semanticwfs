<html>
<head>
<script
  src="https://code.jquery.com/jquery-3.4.1.min.js"
  integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" />
<link rel="stylesheet" href="css/yasqe.css"/>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="js/yasqe.js"></script>
 <style>
  #mapid { height: 500px;}
  </style>
<script>
var overlayMaps={}
var featuretypeToQuery={}
$(document).ready( function () {
	$.getJSON("../service/featureTypes", function(result){
		   $('#servicetitle').html(result["servicetitle"]);
		   var selectcontent="";
		   var tablecontent="<thead><tr><th>FeatureType</th><th>Query</th><th>Namespace</th><th>IndVariable</th>"
		   +"<th>Triple Store</th><th>Options</th></tr></thead><tbody>"
		   for(featuretype in result["datasets"]){
			   selectcontent+="<option value=\""+result["datasets"][featuretype]["name"]+"\">"+result["datasets"][featuretype]["name"]+"</option>"
			   featuretypeToQuery[result["datasets"][featuretype]["name"]]=result["datasets"][featuretype]["query"]
			   tablecontent+="<tr><td>"
			   +result["datasets"][featuretype]["name"]+"</td><td>"
			   +result["datasets"][featuretype]["query"]+"</td><td>"
			   +result["datasets"][featuretype]["namespace"]+"</td><td>"
			   +result["datasets"][featuretype]["indvar"]+"</td><td>"
			   +result["datasets"][featuretype]["triplestore"]+"</td><td><i class=\"fa fa-pencil-square\" aria-hidden=\"true\"></i><i class=\"fa fa-minus-square\" aria-hidden=\"true\"></i> </td></tr>"
		   }
		   tablecontent+="</tbody>"
		   $('#samplequeries').html(selectcontent);
		   $('#featuretypes').html(tablecontent);
		   $('#featuretypes').DataTable();
		   $("#featuretypes").on('mousedown.edit', "i.fa.fa-pencil-square", function(e) {

		        $(this).removeClass().addClass("fa fa-envelope-o");
		        var $row = $(this).closest("tr").off("mousedown");
		        var $tds = $row.find("td").not(':first').not(':last');

		        $.each($tds, function(i, el) {
		          var txt = $(this).text();
		          $(this).html("").append("<input type='text' value=\""+txt+"\">");
		        });

		      });
		   $("#featuretypes").on('mousedown', "input", function(e) {
		        e.stopPropagation();
		      });

		      $("#featuretypes").on('mousedown.save', "i.fa.fa-envelope-o", function(e) {
		        
		        $(this).removeClass().addClass("fa fa-pencil-square");
		        var $row = $(this).closest("tr");
		        var $tds = $row.find("td").not(':first').not(':last');
		        
		        $.each($tds, function(i, el) {
		          var txt = $(this).find("input").val()
		          $(this).html(txt);
		        });
		      });
		      
		      
		       $("#featuretypes").on('mousedown', "#selectbasic", function(e) {
		        e.stopPropagation();
		      });
		});
	$.getJSON("../service/prefixes", function(result){
		   $('#prefixes').html(result);
		});
} );

function chooseSampleQuery(){
	yasqe.setValue(prefixList+"\n"+$('#samplequeries :selected').val().replace(".",".\n").replace("}","\n}\n").replace("{","{\n"))
    $('#queryinput').val(prefixList+"\n"+$('#samplequeries :selected').val().replace(".",".\n").replace("}","\n}\n").replace("{","{\n"));
}
    
function addFeature(){
	
}
</script>
</head>
<body>
<h1 id="servicetitle" align="center"></h1>
<div class="container" role="main">
  <div class="row">
  <div class="col-sm-5">
Query Input:<br/>
<span id="numberexamples"></span> Feature Type Queries:
<script>
$( document ).ready(function() {
	chooseSampleQuery();
});
</script>
<select id="samplequeries" onChange="chooseSampleQuery()">
<option value='SELECT ?accum_geom ?the_geom WHERE { ?geom geo:asWKT ?the_geom . BIND(geo:ST_Accum(?the_geom,?the_geom) AS ?accum_geom) } LIMIT 100'>geo:ST_Accum</option>
</select>&nbsp;<a href="#" id="postgisdoc" target="_blank">POSTGIS Docs</a>
<br/>
<textarea id="queryinput" rows=4 cols=45>
</textarea>
<table width="100%">
<tr><td>Featuretype Name:</td><td><input type="text" id="featuretypename"/></td></tr>
<tr><td>TripleStore:</td><td><input type="text" id="triplestore"/></td></tr>
<tr><td>IndVariable:</td><td><input type="text" id="indvariable"/></td></tr>
<tr><td colspan="2"><button id="addquery" onClick="addFeature()">Add FeatureType</button></td></tr>
</table>
</div>
<div class="col-sm-7" id="mapid">

      
<script>
var mymap = L.map('mapid',{fullscreenControl: true,fullscreenControlOptions: {position: 'topleft'}}).setView([51.505, -0.09], 13);
	//var mymap = L.map('mapid').setView([51.505, -0.09], 13);
	var layer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
	});
	var yasqe = YASQE.fromTextArea(document.getElementById("queryinput"));
	var wmsLayer = L.tileLayer.wms('https://sgx.geodatenzentrum.de/wms_topplus_web_open', {
layers: 'web',
format: 'image/png',
 transparent: true,
attribution: '&copy; Bundesamt f&uuml;r Kartographie und Geod&auml;sie 2017, <a href="http://sg.geodatenzentrum.de/web_public/Datenquellen_TopPlus_Open.pdf">Datenquellen</a>'
});
	var baseMaps = {
    "BKG": wmsLayer,
        "OSM": layer
	};
	baseMaps["OSM"].addTo(mymap);
	L.control.scale({
	position: 'bottomright',
	imperial: false
}).addTo(mymap);
var layercontrol=L.control.layers(baseMaps,overlayMaps).addTo(mymap);
</script>
  </div></div></div><div class="row">
  <div class="col-sm-12">
  
<table id="featuretypes" width="100%" border="1">
</table>
<span id="prefixes">

</span>
</div></div>
</body>
</html>